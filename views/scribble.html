<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="public/css/scribble.css" />
</head>
<body>
    <div class="container">
        <h1>Scribble</h1>

        <div class="section">
            <div class="section-title">Upload File</div>
            <form id="uploadForm" class="upload-section">
                <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" style="display: none" />
                    <p>Click or drag files here to upload</p>
                    <div id="fileInfo" class="file-info"></div>
                </div>
                <button type="submit" class="submit-btn">Upload File</button>
            </form>
        </div>

        <div class="section">
            <div class="section-title">Output</div>
            <textarea id="outputBox" class="output-box" placeholder="Output will appear here..." readonly></textarea>
        </div>

        <div class="section">
            <div class="section-title">Notes Editor</div>
            <textarea class="notes-editor" placeholder="Start typing your notes here..."></textarea>
        </div>

        <button class="save-btn" onclick="saveNotes()">Save Notes</button>
    </div>

    <script>
        function saveNotes() {
            alert('Notes saved!');
        }

        function updateFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            if (file) {
                const fileSize = (file.size / 1024).toFixed(2);
                fileInfo.innerHTML = `Selected: ${file.name} (${fileSize} KB)`;
                fileInfo.style.display = 'block';
            } else {
                fileInfo.innerHTML = '';
                fileInfo.style.display = 'none';
            }
        }
        
        document
        .getElementById('fileInput')
        .addEventListener('change', function (e) {
          const file = e.target.files[0];
          updateFileInfo(file);
        });

        // Modified form submission handler
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Upload failed');
                    }

                    const data = await response.json();
                    document.getElementById('outputBox').value = data.content;
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error uploading file');
                }
            }
        });

        // Handle drag and drop
        const dropZone = document.querySelector('.file-upload');

        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                updateFileInfo(file);
            }
        });
    </script>
</body>
</html>